    efuiinsel = 0

    efuitype = 0
    efuiattr0 = 0
    efuiattr1 = 0
    efuiattr2 = 0
    efuiattr3 = 0
    efuiattr4 = 0

    efuidotype = 1
    efuidoattr0 = 1
    efuidoattr1 = 1
    efuidoattr2 = 1
    efuidoattr3 = 1
    efuidoattr4 = 1

    entupdate = [ entset $tmpt $tmp0 $tmp1 $tmp2 $tmp3 ]

    initentgui = [
        tmpt = (enttype)
        @(loopconcat i 4 [result [
            tmp@i = (entattr @i)
        ]])
    ]

    genentattributes = [
        entattributes = ""
        n = (listlen $arg2)
        loop i $n [
            entattributes = (concat $entattributes [
                guitext @(at $arg2 $i)
                guislider tmp@i @(at $arg3 (* 2 $i)) @(at $arg3 (+ 1 (* 2 $i))) entupdate
            ])
        ]
    ]

    newgui entfind [
        guitext (_ "set the attributes below to search for")
        guistrut 1
        guilist [
            guicheckbox (_ "type   ") efuidotype
            guistrut 1
            efuitypename = (at $enttypelist $efuitype)
            guifield efuitypename 11 [efuitypeval = (indexof $enttypelist $efuitypename)
            if (>= $efuitypeval 0) [efuitype = $efuitypeval]]
        ]
        loop i 5 [
            guilist [
                guicheckbox [attr @(+ $i 1)] [efuidoattr@i]
                guistrut 1
                guifield [efuiattr@i] 11 [ efuiattr@i = (+ $efuiattr@i 0)]
            ]
        ]

        guilist [
            guiradio (_ "off") efuiinsel 0
            guistrut 1
            guiradio (_ "inside selection") efuiinsel 1
            guistrut 1
            guiradio (_ "outside selection") efuiinsel 2
        ]

        guibar
        guistayopen [
            guibutton (_ "copy attributes from currently selected entity") [
                loop i 5 [
                    [efuiattr@i] = (+ (entattr $i) 0)
                    echo [efuiattr@i] = (+ (entattr $i) 0)
                ]
                efuitypeval = (indexof $enttypelist (enttype))
                if (>= $efuitypeval 0) [efuitype = $efuitypeval]
            ]
            guibutton (_ "select all valid entities") [entselect [efuimatch]]
        ]

        guitab type
        guilist [
            loop i (+ (div (listlen $enttypelist) 10) 1) [
                guilist [
                    loop j (min (- (listlen $enttypelist) (* 10 $i)) 10) [
                        guiradio (at $enttypelist (+ $j (* $i 10))) efuitype (+ $j (* $i 10))
                    ]
                ]
            ]
        ]
    ]

    newmapsize = 12
    savemap_name = temp

    newgui edit [
        guilist [
            guilist [
                guibutton   (_ "toggle walk / edit mode")            "edittoggle"
                guitext " "
                guibutton   (_ "open textures menu..")               "showtexgui"
                guibutton   (_ "open this edit menu..")               " "
                guibutton   (_ "open materials menu..")               "showgui materials"
                guibutton   (_ "open console..")                  "saycommand /"
                guitext " "
                guibutton    (_ "optimize geometry")                  "remip"
                guibutton   (_ "patch existing lightmap (patch)")      [fullbright 0; patchlight]
                guibutton   (_ "quick calculate lights (preview)")      [fullbright 0; calclight -1]
                guibutton    (_ "full calculate lights (full)")         [fullbright 0; calclight 1]
                guitext " "
                guibutton   (_ "environment settings..")            "showgui environment"
                guitext " "
                guibutton   (_ "claim privileges..")               "showgui serverpriv"
                guitext " "
                guibutton    (_ "send map to server")               "sendmap"
                guibutton   (_ "get map from server")               "getmap"
                guitext " "
                guibutton   (_ "take screenshot")                  [ cleargui; sleep 0 [ screenshot ] ]
            ]
            guispring
            guilist [
                guitext (format (_ "key %1") (searcheditbinds "edittoggle"))
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "showtexgui"))
                guitext (format (_ "key %1") (searcheditbinds "showgui edit"))
                guitext (format (_ "key %1") (searcheditbinds "showgui materials"))
                guitext (format (_ "key %1") (searcheditbinds "saycommand /" 0 "" "" " or "))
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "remip"))
                guitext (format (_ "key %1") (searcheditbinds [fullbright 0; patchlight]))
                guitext (format (_ "key %1") (searcheditbinds [fullbright 0; calclight -1]))
                guitext (format (_ "key %1") (searcheditbinds [fullbright 0; calclight 1]))
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "sendmap"))
                guitext (format (_ "key %1") (searcheditbinds "getmap"))
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "screenshot"))
            ]
            guispring
        ]



        guitab file
        guitext (_ "set and change file properties of the currently loaded map:")
        guistrut 0.5
        guilist [
            guilist [
                guistrut 0.5
                guitext    (_ "set map title:")
                guistrut 0.75
                guitext    (_ "set map author:")
                guistrut 0.75
                guitext    (_ "set map filename:")
                guistrut 1.25
                guibutton   (_ "^fs^fgSAVE^fS map with these properties")            "savemap"
                guistrut 0.5
                guibutton    (_ "increase mapsize (2x)")                    "mapenlarge"
                guistrut 0.5
                guibutton   (_ "start new map")                        "showgui newmapgui"
            ]
            guispring
            guilist [
                guistrut 0.5
                guifield                                     maptitle 40 [ maptitle $maptitle ]
                guistrut 0.5
                guifield                                      mapauthor 40 [ mapauthor $mapauthor ]
                guistrut 0.5
                guifield                                      savemap_name 40 [ savemap $savemap_name ]
                guistrut 1
                guitext (format "(shortcut key %1)" (searcheditbinds "savemap"))
                guistrut 4
            ]
            guispring
        ]

        guitab ents
        guilist [
            guilist [
                guibutton   (_ "find ents")            "showgui entfind"
                guitext " "
                guibutton   (_ "link selected ents (teleport, sound, trigger)")   "showgui entlink"
                guitext " "
                guibutton   (_ "focus on selected ent")                           "entautoview"
                guibutton   (_ "deselect all ents")                              "entcancel"
                guibutton   (_ "edit selected ent")                              "selentedit"
                guitext " "
                guibutton   (_ "select all ents inside selection area")               "entselect insel"
                guibutton   (_ "select all ents matching selected")                  "selentfindall"
                guitext " "
                guitext " "
                guibutton   (_ "create weapon..")                              "showgui createweapon"
                guibutton   (_ "create playerstart")                           "saycommand [/newent playerstart 0 0 0 0 0]"
                guibutton   (_ "create light..")                              "resetlight;showgui newlight"
                guibutton   (_ "create lightfx..")                              "saycommand [/newent lightfx 0 0 0 0 0]"
                guibutton   (_ "create teleport..")                              "showgui newteleport"
                guibutton   (_ "create mapmodel")                              "saycommand [/newent mapmodel 0 0 0 0 0]"
                guibutton   (_ "create sound")                                 "saycommand [/newent sound 0 0 0 0 0]"
                guibutton   (_ "create pusher")                                 "saycommand [/newent pusher 0 90 200 0 0 0]"
                guibutton   (_ "create affinity (flag, bomb)")                     "saycommand [/newent affinity 0 0 0 0 0]"
                guibutton   (_ "create actor")                                 "saycommand [/newent actor 0 0 0 0 0 0 0 0 0]"
                guibutton   (_ "create trigger")                              "saycommand [/newent trigger 0 0 0 0 0 0 ]"
                guibutton   (_ "create checkpoint")                              "saycommand [/newent checkpoint 0 0 0 0 0 0 ]"
            ]
            guispring
            guilist [
                guitext " "
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "entlink"))
                guitext " "
                guitext (format (_ "key COMMA %1 + scroll") (searcheditbinds [ domodifier 10; onrelease entautoview ]))
                guitext (format (_ "key %1") (searcheditbinds "entcancel"))
                guitext (format (_ "key %1") (searcheditbinds "selentedit"))
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "entselect insel"))
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext " "
            ]
            guispring
        ]

        guitab ops
        guilist [
            guilist [
                guibutton   (_ "copy")                                    "copy"
                guibutton   (_ "paste")                                    "paste"
                guitext " "
                guibutton   (_ "mirror geometry per selection orientation")         "flip"
                guibutton   (_ "delete selected ents / geometry")               "
                guibutton   (_ "grab texture from selected face")               "gettex"
                guibutton   (_ "repeat last texture change across entire map")      [allfaces 0; replace]
                guitext " "
                guibutton   (_ "toggle heightmap mode")                        "hmapedit 1"
                guitext " "
                guibutton   (_ "materials..")                              [showgui materials]
                guitext " "
                guibutton   (_ "waypoints..")                              [showgui waypoints]
                guitext " "
                guibutton   (_ "undo")                                    "undo"
                guibutton   (_ "redo")                                    "redo"
                guitext      (_ "undo cache size (default: 5 MB)")
         ]
            
            guispring
            guilist [
                guitext (format (_ "key %1") (searcheditbinds "editcopy"))
                guitext (format (_ "key %1") (searcheditbinds "editpaste"))
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "editflip"))
                guitext (format (_ "key %1") (searcheditbinds "editdel"))
                guitext (format (_ "key %1") (searcheditbinds "gettex"))
                guitext " "
                guitext " "
                guitext (format (_ "key H%1") (searcheditbinds " hmapedit (! $hmapedit); blendpaintmode 0 "))
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "showgui materials"))
                guitext " "
                guitext " "
                guitext " "
                guitext (format (_ "key Z%1") (searcheditbinds [undo; passthroughsel 0 ]))
                guitext (format (_ "key %1") (searcheditbinds "redo"))
                guislider                                          "undomegs" 1 10"
                guitext " "
            ]
            guispring
        ]

        guitab vtex
        guilist [
            guilist [
                guitext (_ "create new version of the selected face texture:")
                guitext ""
                guibutton (_ "color..")                                       "showgui vcolour"
                guitext " "
                guibutton (_ "scale..")                                       "showgui vscale"
                guibutton (_ "rotate / flip..")                                 "showgui vrotate"
                guibutton (_ "offset texture up or down..")                        "showgui voffset"
                guitext " "
                guibutton (_ "texture scrolling..")                              "showgui vscroll"
                guitext " "
                guibutton (_ "glow color..")                                 "showgui glowcolor"
                guibutton (_ "specularity (gloss)..")                           "showgui specscale"
                guibutton (_ "heightmap intensity..")                           "showgui parallaxscale"
                guitext " "
                guibutton (_ "texture blend painting..")                        "showgui blendmap"
                guitext " "
                guibutton (_ "^foRESET ^fwselected textures to default")            "vreset"
                guitext " "
                guibutton (_ "^foRESET ^fwall textures in map")                     "showgui texreset"
            ]
        ]

        guitab helpers
        guilist [
            guilist [
                guicheckbox   (_ "toggle edit radar")                  [showeditradar]
                guicheckbox   (_ "show material volumes")               "editshowmat"
                guitext " "
                guicheckbox   (_ "toggle fullbright")                  "fullbright"
                guicheckbox   (_ "toggle wireframe")                  "wireframe"
                guicheckbox   (_ "toggle blank geometry")               "blankgeom"
                guicheckbox   (_ "toggle outline")                  "outline"
                guibutton   (_ "set outline color..")               "showgui outlinecolor"
                guitext " "
                guicheckbox   (_ "toggle paste grid")                  "showpastegrid"
                guicheckbox   (_ "toggle cursor grid")               "showcursorgrid"
                guicheckbox   (_ "toggle selection grid")               "showselgrid"
                guicheckbox   (_ "snap ents to grid")                  "entselsnap"
                guitext " "
                guicheckbox   (_ "toggle allfaces texture mode")         "allfaces"
                guitext " "
                guitext    (_ "adjust your float speed (0-1000)")
                guifield                                   floatspeed 10 [ floatspeed $floatspeed ]
            ]
            guispring
            guilist [
                guitext   (_ "toggle edit radar")
                guitext (format (_ "key PLUS%1") (searcheditbinds "showmat")) //?
                guitext " "
                guitext (format (_ "key B%1") (searcheditbinds "fullbright")) //?
                guitext " "
                guitext " "
                guitext (format (_ "key EQUALS%1") (searcheditbinds "outline")) //?
                guitext " "
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "togglegrid"))
                guitext (format (_ "key %1") (searcheditbinds "togglegrid"))
                guitext (format (_ "key %1") (searcheditbinds "togglegrid"))
                guitext " "
                guitext " "
                guitext (format (_ "key MINUS%1") (searcheditbinds "allfaces")) //?
            ]
            guispring
        ]


        guitab lightmap
        guilist [
            guilist [
                guitext (_ "lightprecision (default: 32)")
                guitext (_ "^fr(Notice!)^fw Increasing the lightprecision creates a smaller mapfile")
                guitext " "
                guitext (_ "lighterror (default: 8)")
                guitext " "
                guitext (_ "lightthreads (CPU threads/cores) (default: 0)")
                guitext " "
                guibutton (_ "set min light level / shadow color (ambient)...")                   "showgui environment 2"
                guitext " "
                guibutton (_ "optimize geometry")                                    "remip"
                guibutton (_ "patch existing lightmap (patch)")                           [fullbright 0; patchlight]
                guibutton (_ "quick calculate lights (preview)")                        [fullbright 0; calclight -1]
                guibutton (_ "full calculate lights (full)")                           [fullbright 0; calclight 1]
            ]
            guispring
            guilist [
                guilistslider lightprecision "8 16 32 48 64 128 256"
                guitext " "
                guitext " "
                guislider lighterror
                guitext " "
                guislider lightthreads
                guitext " "
                guitext " "
                guitext " "
                guitext (format (_ "key %1") (searcheditbinds "remip"))
                guitext (format (_ "key %1") (searcheditbinds [fullbright 0; patchlight]))
                guitext (format (_ "key %1") (searcheditbinds [fullbright 0; calclight -1]))
                guitext (format (_ "key %1") (searcheditbinds [fullbright 0; calclight 1]))
            ]
            guispring
        ]

        guitab keyref
        guilist [
            guilist [
                guitext (_ "change gridsize")
                guitext (_ "select")
                guitext (_ "extend selection / select additional ents")
                guitext   (_ "move selection area / move selected ents")
                guitext   (_ "deselect all")
                guitext   (_ "orient selection face")
                guitext   (_ "create /destroy cubes")
                guitext   (_ "push / pull selected faces")
                guitext   (_ "push / pull corner")
                guitext (_ "select multiple corners")
                guitext   (_ "move selected geometry")
                guitext   (_ "copy")
                guitext   (_ "paste")
                guitext   (_ "rotate geometry per selection orientation")
                guitext   (_ "mirror geometry per selection orientation")
                guitext   (_ "quick texture selected faces")
                guitext   (_ "grab texture from selected faces")
                guitext (_ "change properties of selected ents")
                guitext   (_ "cycle link modes for selected ents")
                guitext   (_ "change brush type")
            ]
            guispring
            guilist [
                guitext (format (_ "hold key %1 + scroll wheel") (searcheditbinds "domodifier 1"))
                guitext (format (_ "drag left mouse button"))
                guitext (format (_ "right mouse button"))
                guitext (format (_ "drag right mouse button"))
                guitext (format (_ "key %1 ") (searcheditbinds cancelsel))
                guitext (format (_ "right mouse button"))
                guitext (format (_ "scroll mouse wheel"))
                guitext (format (_ "hold key %1 + scroll mouse wheel") (searcheditbinds "domodifier 2"))
                guitext (format (_ "hold key %1 + scroll wheel") (searcheditbinds "domodifier 3"))
                guitext (format (_ "drag middle mouse button"))
                guitext (format (_ "hold key %1 + drag right mouse button") (searcheditbinds editcut))
                guitext (format (_ "key %1") (searcheditbinds editcopy))
                guitext (format (_ "key %2") (searcheditbinds editpaste))
                guitext (format (_ "hold key %1 + scroll mouse wheel") (searcheditbinds "domodifier 4"))
                guitext (format (_ "key %1") (searcheditbinds editflip))
                guitext (format (_ "hold key %1 + scroll mouse wheel") (searcheditbinds "domodifier 6"))
                guitext (format (_ "key %1") (searcheditbinds gettex))
                guitext (format (_ "hold number keys 1-9 + scroll mouse wheel"))
                guitext (format (_ "key %1") (searcheditbinds entlink))
                guitext (format (_ "hold key %1 + scroll mouse wheel") (searcheditbinds "domodifier 9"))
            ]
            guispring
        ]

        guitab cfg
        guitext [@[mapname].cfg]
        showfileeditor [@[mapname].cfg] -80 20
    ]









    newgui serverpriv [
        guistayopen [
            guiradio   (_ "veto server")               openservertype 0   [serveropen 3]
            guiradio   (_ "open server")               openservertype 1   [serveropen 1]
            guiradio   (_ "coop server")               openservertype 2   [serveropen 2]
            guitext " "
            guibutton   (_ "claim privileges")            "setpriv 1"
            guibutton   (_ "relinquish privileges")         "setpriv 0"
            guitext " "
            guibutton   (_ "administrator password")      "saycommand [/adminpass ]"
        ]
    ]

    newgui waypoints [
            guicheckbox   (_ "show waypoints")                     "showwaypoints"
            guicheckbox   (_ "create waypoints")                     "dropwaypoints"
            guiradio   (_ "gamespeed 100% (default)")               gamespeedtype 0   [gamespeed 100]
            guiradio   (_ "gamespeed 200% (faster waypointing)")      gamespeedtype 1   [gamespeed 200]
            guiradio   (_ "gamespeed 75% (slower waypointing)")      gamespeedtype 2   [gamespeed 75]
            guitext " "
            guibutton   (_ "add bot")                           "addbot"
            guibutton   (_ "remove bot")                        "delbot"
            guitext " "
            guibutton   (_ "^foSAVE ^fwwaypoints")                  "savewaypoints"
            guibutton   (_ "^foLOAD ^fwwaypoints")                  "saycommand [/loadwaypoints ]"
            guibutton   (_ "^foSAVE ^fwmap")                     "savemap"
            guibutton   (_ "^foCLEAR ^fwwaypoints in selection area")   "saycommand [/delselwaypoints]"
            guibutton   (_ "^foCLEAR ^fwall waypoints")               "saycommand [/clearwaypoints]"
    ]
    newgui createweapon [
            guilist [
                guilist [
                guitext   "^fo/newent weapon ^fy#"
                guibutton (_ "sword")         "newent weapon 2"
                guibutton (_ "shotgun")         "newent weapon 3"
                guibutton (_ "smg")            "newent weapon 4"
                guibutton (_ "flamer")         "newent weapon 5"
                guibutton (_ "plasma")         "newent weapon 6"
                guibutton (_ "taser")         "newent weapon 7"
                guibutton (_ "rifle")         "newent weapon 8"
                guibutton (_ "grenade")         "newent weapon 9"
                guibutton (_ "mine")         "newent weapon 10"
                guibutton (_ "rocket")         "newent weapon 11"
                ]
                guilist [
                guitext " "
                guitext (_ "weapon 2")
                guitext (_ "weapon 3")
                guitext (_ "weapon 4")
                guitext (_ "weapon 5")
                guitext (_ "weapon 6")
                guitext (_ "weapon 7")
                guitext (_ "weapon 8")
                guitext (_ "weapon 9")
                guitext (_ "weapon 10")
                ]
            ]
    ]

    newgui newmapgui [
            guibutton    (_ "^foREVERT ^fwto last saved version of @savemap_name")      "map $savemap_name"
            guitext " "
            guibutton   (_ "^foOPEN ^fwan existing map")                        "showgui maps 1"
            guitext " "
            guibutton    (_ "^foCLEAR MAP ^fwand begin a new one ^fr(Warning!)")         "newmap $newmapsize"
            guitext      (_ "size of new map")
            guislider    "newmapsize" 10 16
    ]

    newgui outlinecolor [
                guiradio   (_ "white")               outlinetype 1 [outlinecolour 255 255 255]
                guiradio   (_ "black")               outlinetype 2 [outlinecolour 0 0 0]
                guiradio   (_ "blue")               outlinetype 3 [outlinecolour 80 80 255]
                guiradio   (_ "red")               outlinetype 4 [outlinecolour 255 80 80]
                guiradio   (_ "green")               outlinetype 5 [outlinecolour 80 255 80]
                guiradio   (_ "yellow")            outlinetype 6 [outlinecolour 255 255 80]
                guitext " "
                guicheckbox   (_ "toggle outline")      "outline"
    ]


    newgui entlink [
        guistayopen [
        guitext (_ "^fo/entlink ^fw cycles link modes of selected ents")
        guitext " "
        guibutton    (_ "cycle linkmode +         key L")               "entlink"
        guitext " "
        guitext    (_ "link modes:")
        guitext      "1. A     B"
        guitext    "2. ^frA >> B"
        guitext      "3. ^fyA <> B"
        guitext    "4. ^frA << B"
        guitext " "
        guibutton   (_ "create new teleport")                            "saycommand [/newent teleport -1 0 0 0 655 0]"
        guibutton   (_ "create new sound")                              "saycommand [/newent sound 0 0 0 0 0]"
        guibutton   (_ "create new trigger")                           "saycommand [/newent trigger 0 0 0 0 0 0 0]"
        ]


    ]


    newgui vcolour [
        guistayopen [
            guitext "^fo/vcolour ^fr%R ^fg%G ^fb%B"
            guitext " "
            guibutton (_ "red")            "saycommand [/vcolour 1.0 0.3 0.3]"
            guibutton (_ "green")         "saycommand [/vcolour 0.3 1.0 0.3]"
            guibutton (_ "blue")         "saycommand [/vcolour 0.3 0.3 1.0]"
            guibutton (_ "orange")         "saycommand [/vcolour 1.0 0.6 0.2]"
            guibutton (_ "yellow")         "saycommand [/vcolour 1.0 0.8 0.3]"
            guibutton (_ "purple")         "saycommand [/vcolour 0.5 0.2 0.7]"
            guibutton (_ "turquoise")      "saycommand [/vcolour 0.1 0.8 0.8]"
            guibutton (_ "dark")         "saycommand [/vcolour 0.3 0.3 0.3]"
            guibutton (_ "white")         "saycommand [/vcolour 1.0 1.0 1.0]"
        ]
    ]

    newgui vscale [
        guistayopen [
        guitext "^fo/vscale ^fy% ^fw(0.125 - 8.0)"
        guitext " "
        guibutton "12.5%"      "saycommand [/vscale .125]"
        guibutton "25%"         "saycommand [/vscale .25]"
        guibutton "50%"         "saycommand [/vscale .5]"
        guibutton "75%"         "saycommand [/vscale .75]"
        guibutton "100%"      "saycommand [/vscale 1]"
        guibutton "150%"      "saycommand [/vscale 1.5]"
        guibutton "400%"      "saycommand [/vscale 4]"
        guibutton "800%"      "saycommand [/vscale 8]"
        ]
    ]

    newgui vrotate [
        guistayopen [
            guitext (_ "^fo/vrotate ^fy# ^fy(1-3 rotate, 4-5 flip)")
            guitext " "
            guibutton (_ "rotation/flip +")               "vdelta vrotate 1"
            guibutton (_ "rotation/flip -")               "vdelta vrotate -1"
            guitext " "
            guibutton (_ "rotate 90")                  "saycommand [/vrotate 1]"
            guibutton (_ "rotate 180")                  "saycommand [/vrotate 2]"
            guibutton (_ "rotate 270")                  "saycommand [/vrotate 3]"
            guitext " "
            guibutton (_ "flip vertical")               "saycommand [/vrotate 4]"
            guibutton (_ "flip horizontal")               "saycommand [/vrotate 5]"
            guitext " "
            guibutton (_ "^foRESET ^fwto 0")            "saycommand [/vrotate 0]"
        ]
    ]

    newgui specscale [
        guitext "^fo/vdelta vshaderparam specscale ^fr%R ^fg%G ^fb%B"
        guitext " "
        guibutton (_ "red gloss")            "saycommand [/vdelta vshaderparam specscale 1.0 0.3 0.3]"
        guibutton (_ "green gloss")            "saycommand [/vdelta vshaderparam specscale 0.3 1.0 0.3]"
        guibutton (_ "blue gloss")            "saycommand [/vdelta vshaderparam specscale 0.3 0.3 1.0]"
        guibutton (_ "orange gloss")         "saycommand [/vdelta vshaderparam specscale 1.0 0.6 0.2]"
        guibutton (_ "yellow gloss")         "saycommand [/vdelta vshaderparam specscale 1.0 0.8 0.3]"
        guibutton (_ "purple gloss")         "saycommand [/vdelta vshaderparam specscale 0.5 0.2 0.7]"
        guibutton (_ "turquoise gloss")         "saycommand [/vdelta vshaderparam specscale 0.1 0.8 0.8]"
        guibutton (_ "50% gloss (subtle)")      "saycommand [/vdelta vshaderparam specscale 0.5 0.5 0.5]"
        guibutton (_ "no gloss (matte)")      "saycommand [/vdelta vshaderparam specscale 0.0 0.0 0.0]"
        guitext " "
        guibutton (_ "^foRESET ^fwto 100%")      "saycommand [/vdelta vshaderparam specscale 1.0 1.0 1.0]"
    ]

    newgui glowcolor [
        guitext "^fo/vdelta vshaderparam glowcolor ^fr%R ^fg%G ^fb%B"
        guitext " "
        guibutton (_ "red")                  "saycommand [/vdelta vshaderparam glowcolor 1.0 0.3 0.3]"
        guibutton (_ "green")               "saycommand [/vdelta vshaderparam glowcolor 0.3 1.0 0.3]"
        guibutton (_ "blue")               "saycommand [/vdelta vshaderparam glowcolor 0.3 0.3 1.0]"
        guibutton (_ "orange")               "saycommand [/vdelta vshaderparam glowcolor 1.0 0.6 0.2]"
        guibutton (_ "yellow")               "saycommand [/vdelta vshaderparam glowcolor 1.0 0.8 0.3]"
        guibutton (_ "purple")               "saycommand [/vdelta vshaderparam glowcolor 0.5 0.2 0.7]"
        guibutton (_ "turquoise")            "saycommand [/vdelta vshaderparam glowcolor 0.1 0.8 0.8]"
        guitext " "
        guibutton (_ "^foRESET ^fwto 100%")      "saycommand [/vdelta vshaderparam glowcolor 1.0 1.0 1.0]"
    ]

    newgui parallaxscale [
        guitext "^fo/vdelta vshaderparam parallaxscale ^fr%R ^fg%G ^fb%B"
        guitext " "
        guibutton (_ "flat")                        "saycommand [/vdelta vshaderparam parallaxscale 0.0 0.0 0.0]"
        guibutton (_ "extreme")                        "saycommand [/vdelta vshaderparam parallaxscale 0.0025 0.0025 0.0025]"
        guibutton (_ "another dimension")               "saycommand [/vdelta vshaderparam parallaxscale 1.0 1.0 1.0]"
        guitext " "
        guibutton (_ "^foRESET ^fwto default")            "saycommand [/vdelta vshaderparam parallaxscale 0.0000025 0.0000025 0.0000025]"
    ]

    newgui vscroll [
        guistayopen [
            guitext    "^fo/vscroll ^fyX Y"
            guitext " "
            guibutton    (_ "scroll Y +")         "vdelta vscroll 0 +0.1"
            guibutton    (_ "scroll Y -")         "vdelta vscroll 0 -0.1"
            guitext " "
            guibutton    (_ "scroll X +")         "vdelta vscroll +0.1 0"
            guibutton    (_ "scroll X -")         "vdelta vscroll -0.1 0"
            guitext " "
            guibutton    (_ "^foRESET ^fwto 0")         "saycommand [/vscroll 0 0]"
        ]
    ]

    newgui voffset [
        guistayopen [
            guitext "^fo/voffset ^fyXpx Ypx"
            guitext " "
            guibutton    (_ "offset Y +")         "vdelta voffset 0 +16"
            guibutton    (_ "offset Y -")         "vdelta voffset 0 -16"
            guitext " "
            guibutton    (_ "offset X +")         "vdelta voffset +16 0"
            guibutton    (_ "offset X -")         "vdelta voffset -16 0"
            guitext " "
            guibutton    (_ "^foRESET ^fwto 0")         "saycommand [/voffset 0 0]"
        ]
    ]

    newgui blendmap [
        guilist [
            guilist [
                guilist [
                    guilist [
                        guistayopen [
                            guitext (_ "assign a blend layer to selected texture:")
                            guitext (_ "^fo/vlayer ^fy# ^fw(slot number)")
                            guitext " "
                            guilist [
                                guistrut 0
                                guitext (_ "texture slot number: ")
                                guifield slotnum -8
                            ]
                            guibutton (_ "^foADD ^fwabove brush") [vlayer $slotnum]
                            guibutton (_ "^foREMOVE ^fwabove brush") [vlayer ""]
                        ]
                    ]
                ]
                guibutton (_ "open textures menu..") [showtexgui]
                guitext " "
                guistayopen [
                    guibutton (_ "cycle blend paint modes") [
                        hmapedit 0
                        blendpaintmode (? (= $blendpaintmode 5) 0 (+ $blendpaintmode 1))
                        echo (concat (_ "^fgblend mode:^fw") (at $paintmodes $blendpaintmode))
                    ]
                    guibutton (_ "blend mode off") [blendpaintmode 0]
                    guilist [
                        guibutton (_ "cycle paint brush: ") [nextblendbrush -1]
                        guitext (getblendbrushname (curblendbrush))
                    ]
                    guitext " "
                    guibutton (_ "generate preview") showblendmap
                    guitext " "
                    guibutton (_ "^foCLEAR ^fwBlendmap") clearblendmap
                ]
            ]
            guilist [
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext " "
                guitext (_ "   key F2")
                guitext " "
                guitext (_ "   key P")
                guitext   (_ "   key Alt")
                guitext   (_ "    scroll mouse wheel")
                guitext " "
                guitext " "
                guitext " "
            ]
        ]
    ]

    newgui texreset [
        guilist [
            guilist [
            guibutton (_ "^foCLEAR ^fwall unused textures from map cfg") [saycommand /texturecull]
            guibutton (_ "^foCLEAR ^fwall textures from map cfg") [saycommand /texturereset]
            guibutton (_ "^foLOAD ^fwdefault texture package to map cfg (reload map required)") [saycommand /exec data/textures.cfg]
            ]
        ]
    ]

    newgui environment [
        guistayopen [
        guitext         (_ "quick global lighting:")
        guitext " "
        guibutton      (_ "night")                              [ambient 40 40 40; skylight 70 80 90; skybox skyboxes/stars; skycolour 255 255 255; cloudlayer skyboxes/clouds01; cloudlayercolour 50 60 100; cloudlayerblend 0.3; cloudscrollx 0.005; fogcolour 12 10 13; fog 2000; calclight -1]
        guibutton      (_ "morning")                           [ambient 60 35 40; skylight 170 140 145; skybox penguins/harmony; skycolour 255 160 180; cloudlayer skyboxes/clouds03; cloudlayercolour 255 125 170; cloudlayerblend 0.2; cloudscrollx 0.01; fogcolour 129 79 59; fog 2000; calclight -1]
        guibutton      (_ "evening")                           [ambient 50 30 10; skylight 180 100 70; skybox skyboxes/sunsetflat; skycolour 255 255 255; cloudlayer skyboxes/clouds01; cloudlayercolour 255 100 50; cloudlayerblend 0.2; cloudscrollx 0.005; fogcolour 40 20 5; fog 2000; calclight -1]
        guitext " "
        guibutton      (_ "^foRESET ^fwenvironment to default")      [ambient 0 0 0; skylight 0 0 0; skybox ""; skycolour 255 255 255; cloudlayer ""; cloudlayercolour 255 255 255; cloudlayerblend 1.0; cloudscrollx 0; fogcolour 128 153 179; fog 4000; calclight -1]

        guitab ambient
        guitext         "^fo/ambient ^frR ^fgG ^fbB"
        guibutton      (_ "grey shadows")                        "saycommand [/ambient 40 40 40]"
        guibutton      (_ "purple shadows")                     "saycommand [/ambient 60 35 40]"
        guibutton      (_ "brown shadows")                        "saycommand [/ambient 50 30 10]"
        guitext " "
        guibutton      (_ "^foRESET ^fwambient to default")         "saycommand [/ambient 0 0 0]"

        guitab skylight
        guitext         "^fo/skylight ^frR ^fgG ^fbB"
        guibutton      (_ "cool skylight")                        "saycommand [/skylight 70 80 90]"
        guibutton      (_ "soft skylight")                        "saycommand [/skylight 170 140 145]"
        guibutton      (_ "warm skylight")                        "saycommand [/skylight 180 100 70]"
        guitext " "
        guibutton      (_ "^foRESET ^fwskylight to default")         "saycommand [/skylight 0 0 0]"


        guitab fog
            guitext    "^fo/fog ^fy#"
            guibutton    (_ "fog distance far")            "saycommand [/fog 1500]"
            guibutton    (_ "fog distance distant")         "saycommand [/fog 800]"
            guibutton    (_ "fog distance near")            "saycommand [/fog 300]"
            guibutton    (_ "^foRESET ^fwfog distance")      "saycommand [/fog 4000]"
            guitext " "
            guitext " "
            guitext    "^fo/fogcolour ^frR ^fgG ^fbB"
            guibutton    (_ "black fog (darkness)")            "saycommand [/fogcolour 0 0 0]"
            guibutton    (_ "grey fog (haze)")               "saycommand [/fogcolour 50 50 50]"
            guibutton    (_ "green fog (gas)")               "saycommand [/fogcolour 40 60 45]"
            guibutton    (_ "^foRESET ^fwfog color to default")   "saycommand [/fogcolour 128 153 179]"

        guitab skybox
            guitext    (_ "^fo/skybox ^fyfolder/filename")
            guibutton    (_ "set skybox to skyhigh")         "saycommand [/skybox skyboxes/skyhigh]"
            guibutton    (_ "set skybox to sunsetflat")      "saycommand [/skybox skyboxes/sunsetflat]"
            guibutton   (_ "set skybox to gradient")      "saycommand [/skybox skyboxes/gradient]"
            guibutton    (_ "^foREMOVE ^fwskybox")           [saycommand "/skybox ^"^""]
            guitext " "
            guitext " "
            guitext      "^fo/skycolour ^frR ^fgG ^fbB"
            guibutton   (_ "set sky color to orange")      "saycommand [/skycolour 255 150 20]"
            guibutton   (_ "set sky color to yellow")      "saycommand [/skycolour 150 150 80]"
            guibutton   (_ "set sky color to red")         "saycommand [/skycolour 180 80 80]"
            guibutton   (_ "set sky color to blue")         "saycommand [/skycolour 80 80 180]"
            guibutton   (_ "set sky color to black")      "saycommand [/skycolour 80 80 80]"
            guibutton    (_ "^foRESET ^fwsky color")         "saycommand [/skycolour 255 255 255]"

        guitab clouds
            guitext    (_ "^fo/cloudlayer ^fyfolder/filename")
            guibutton    (_ "set clouds to clouds01")         "saycommand [/cloudlayer skyboxes/clouds01]"
            guibutton    (_ "set clouds to clouds02")         "saycommand [/cloudlayer skyboxes/clouds02]"
            guibutton    (_ "set clouds to clouds03")         "saycommand [/cloudlayer skyboxes/clouds03]"
            guibutton    (_ "^foREMOVE ^fwcloudlayer")          [saycommand "/cloudlayer ^"^""]
            guitext " "
            guitext " "
            guitext      "^fo/cloudlayercolour ^frR ^fgG ^fbB"
            guibutton   (_ "set cloud color to orange")      "saycommand [/cloudlayercolour 255 150 20]"
            guibutton   (_ "set cloud color to yellow")      "saycommand [/cloudlayercolour 150 150 80]"
            guibutton   (_ "set cloud color to red")      "saycommand [/cloudlayercolour 180 80 80]"
            guibutton   (_ "set cloud color to blue")      "saycommand [/cloudlayercolour 80 80 180]"
            guibutton   (_ "set cloud color to black")      "saycommand [/cloudlayercolour 80 80 80]"
            guibutton    (_ "^foRESET ^fwcloud color")      "saycommand [/skycolour 255 255 255]"

            guitab vars
            guitext   "^fo/gravity ^fy%"
            guibutton   (_ "none")                        "saycommand   [/gravity 5.0]"
            guibutton   (_ "low")                        "saycommand [/gravity 15.0]"
            guibutton   (_ "default")                     "saycommand [/gravity 50.0]"
            guitext " "

            guitext "^fo/spawnweapon ^fy#"
            guilist [
                guilist [
                guibutton (_ "sword")         "saycommand   [/spawnweapon 2]"
                guibutton (_ "shotgun")         "saycommand   [/spawnweapon 3]"
                guibutton (_ "smg")            "saycommand   [/spawnweapon 4]"
                guibutton (_ "flamer")         "saycommand   [/spawnweapon 5]"
                guibutton (_ "taser")           "saycommand   [/spawnweapon 6]"
                ]

                guilist [
                guibutton "         plasma"             "saycommand   [/spawnweapon 7]"
                guibutton "         rifle"            "saycommand   [/spawnweapon 8]"
                guibutton "         grenade"         "saycommand   [/spawnweapon 9]"
                guibutton "         mine"            "saycommand   [/spawnweapon 10]"
                guibutton "         rocket"            "saycommand   [/spawnweapon 11]"
                ]
            ]
                guitext " "
                guitext   (_ "^foplayer vars")
                guibutton (_ "maximum inventory (default 2)")      "saycommand [/maxcarry 9]"
                guibutton (_ "jumpspeed (default 100)")          "saycommand [/jumpspeed 200]"
                guibutton (_ "impulse freestyle (default 1)")      "saycommand [/impulsestyle 3]"

        guibutton (_ "show all variables..")         "showgui vars"

        ]
    ]
    resetlight = [
        lightcolour = 0
        lightrgb = "255 255 255"
        lightbright = 1
        lightradius = 128
    ]

    lightcmd = [
        lightr = (at $lightrgb 0)
        lightg = (at $lightrgb 1)
        lightb = (at $lightrgb 2)
        if (! $lightbright) [
            if (=s $lightrgb "255 255 255") [
                lightr = 192; lightg = 192; lightb = 192
            ] [
                lightr = (div $lightr 2); lightg = (div $lightg 2); lightb = (div $lightb 2)
            ]
        ]
        result (concat newent light $lightradius $lightr $lightg $lightb)
    ]

    newgui newlight [
        guibutton (_ "create a sunlight entity          ") "saycommand [/newent sunlight 45 320 100 70 50]"
        guitext " "
        guitext (_ "light radius:")
        guislider lightradius 0 800
        guiradio (_ "white")                         lightcolour 0 [lightrgb = "150 150 150"]
        guiradio (_ "blue")                        lightcolour 1 [lightrgb = "80 80 180"]
        guiradio (_ "red")                         lightcolour 2 [lightrgb = "180 80 80"]
        guiradio (_ "green")                       lightcolour 3 [lightrgb = "80 180 80"]
        guiradio (_ "yellow")                      lightcolour 4 [lightrgb = "150 150 80"]
        guiradio (_ "purple")                      lightcolour 5 [lightrgb = "150 80 150"]
        guiradio (_ "turquoise")                   lightcolour 6 [lightrgb = "80 150 150"]
        guitext " "
        guicheckbox (_ "bright")                   lightbright
        guitext " "
        guibutton (_ "^foCREATE") (lightcmd)
        guibutton (lightcmd)
    ]


    newgui newteleport [
       guitext (_ "^fo/newent teleport ^fwlink teleports with ^fo/entlink ^fw(key L)")
        guitext " "
       guibutton (_ "create a new teleport")          "saycommand [/newent teleport -1 0 0 0 655 0]"
    ]

    quickeditmenu = [
        guitext "Quick Commands:"
        guibar
        guifield  savemap_name 10 [ savemap $savemap_name ]
        guibutton quicklight          "calclight -1"
        guibutton (_ "optimize map")      "remip"
        guibutton (_ "new entity")        "newent light"
        guibar
        guibutton newmap
        guibar
        guibutton help "showgui edit"
    ]

    matmenu = [
        guicheckbox      (_ "show material volumes         key M")         "showmat"
        guitext " "
        guibutton   (_ "air                     key Numpad 1")               "editmat air"
        guibutton   (_ "alpha                  key Numpad 2")                  "editmat alpha"
        guibutton   (_ "water                  key Numpad 3")                  "editmat water"
        guibutton   (_ "lava                     key Numpad 4")               "editmat lava"
        guibutton   (_ "clip                     key Numpad 5")               "editmat clip"
        guibutton   (_ "noclip                  key Numpad 6")                  "editmat noclip"
        guibutton   (_ "aiclip                  key Numpad 7")                  "editmat aiclip"
        guibutton   (_ "death                  key Numpad 8")                  "editmat death"
        guibutton   (_ "ladder                  key Numpad 9")                  "editmat ladder"

    ]

    newentgui = [
        genentattributes [@arg1] [@arg2] [@arg3]
        newgui $arg1 [
            guitext $tmpt
            guibar
            @entattributes
            guitab type
            guilistsplit n 2 $enttypelist [
                guibutton $n [ entset @n ]
            ]
        ]
    ]

    looplist i $enttypelist [
        newentgui $i "" ""
    ]

    newgui materials [
        @matmenu

    ]

    newgui quickedit [
        @quickeditmenu
        guitab materials
        @matmenu
    ]

    newentgui light "radius red green blue" "0 400 0 255 0 255 0 255"
    newentgui spotlight "radius" "0 200"
    newentgui playerstart "yaw team id" "0 360"
    newentgui teleport "tag" "0 20"
    newentgui teledest "yaw tag" "0 360 0 20"
    newentgui monster "yaw type" "0 360 0 7"
    newentgui mapmodel "model yaw type tag flags" "360 0 0 100 0 29 0 20"
    newentgui envmap "radius" "0 400"
    newentgui pusher "Z Y X" "0 200 0 200 0 200"
    newentgui carrot "tag type" "0 50 0 29"
    newentgui sound "type radius size" "0 20 0 500 0 500"
    newentgui particles "type" "0 3"

    alias showmapmodel [
        mapmodelpath = (mapmodelindex $arg1)
        mapmodelshot = (concatword "models/" $mapmodelpath "/thumb")
        mapmodelcmd = (concat newent mapmodel $arg1)
        guilistx 2 [
            guiimage $mapmodelshot $mapmodelcmd 2 1 "textures/nothumb"
            guibutton $mapmodelpath $mapmodelcmd
        ]
    ]

    newgui mapmodels [
        mapmodelnum = (mapmodelindex)
        guilistloop 4 2 $mapmodelnum [ showmapmodel $i ]
    ]
